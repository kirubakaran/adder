<html>
<head>
<title>The Adder compiler</title>
</head>

<body>
<h1>The Adder compiler</h1>

<p>Adder doesn't expose a compilation step, but there is a compiler
  under the hood, translating Adder to Python.  (There was an earlier
  prototype which targeted Python bytecode; but Python bytecode
  changes too quickly.  The compiler needed substantial rework to
  target Python 3.1 instead of 3.0.)
</p>

<h2>The intermediate languages</h2>

<p>The Adder compiler uses two intermediate languages: Gomer and
  Pyle.  Adder is reduced to Gomer, which is then compiled to Pyle,
  which is then transliterated to Python.
</p>

<h3>Gomer</h3>

<p>Gomer is actually a subset of Adder, a core language with no
  macros. Gomer expressions get built into ASTs, which are annotated
  with knowledge of lexical scopes (and probably other stuff,
  eventually).
</p>

<h4>Gomer special forms</h4>

<dl>
<dt>begin</dt>
<dt>import</dt>
<dt>defvar</dt>
<dt>defun</dt>
<dt>if</dt>
<dt>lambda</dt>
<dt>scope</dt>
<dt>quote</dt>
<dt>try</dt>
<dd>Each except: clause now takes just a single statement; multiple
  statements require a (begin).  An obvious candidate for macro
  conversion...although that will require renaming the Gomer form.
</dd>
<dt>while</dt>
<dt>break</dt>
<dt>continue</dt>
<dt>yield</dt>
<dt>return</dt>
<dt>:=</dt>
<dt>.</dt>
</dl>

<h4>Gomer functions</h4>

<dl>
<dt>raise</dt>
<dt>head</dt>
<dt>tail</dt>
<dt>reverse</dt>
<dt>reverse!</dt>
<dt>stdenv</dt>
<dt>eval-py</dt>
<dt>exec-py</dt>
<dt>print</dt>
<dt>getattr</dt>
<dt>slice</dt>
<dt>==</dt>
<dt>!=</dt>
<dt>&lt;=</dt>
<dt>&lt;</dt>
<dt>&gt;=</dt>
<dt>&gt;</dt>
<dt>+</dt>
<dt>-</dt>
<dt>*</dt>
<dt>/</dt>
<dt>//</dt>
<dt>%</dt>
<dt>in</dt>
<dt>gensym</dt>
<dt>[]</dt>
<dt>getattr</dt>
<dt>slice</dt>
<dt>list</dt>
<dt>tuple</dt>
<dt>set</dt>
<dt>dict</dt>
<dt>isinstance</dt>
<dt>mk-list</dt>
<dt>mk-tuple</dt>
<dt>mk-set</dt>
<dt>mk-dict</dt>
<dt>mk-symbol</dt>
<dt>reverse</dt>
<dt>reverse!</dt>
<dt>eval</dt>
<dd>TODO: must wait for Adder-to-Gomer layer.</dd>
<dt>stdenv</dt>
<dt>apply</dt>
<dt>load</dt>
<dd>TODO: must wait for Adder-to-Gomer layer.</dd>
</dl>

<h3>Pyle</h3>

<p>Pyle (Python Lisplike Encoding) is an encoding of a subset of
  Python in Lispy data structures.  It doesn't need to encode all of
  Python; it just needs to be the subset that the Gomer compiler will
  emit.  I could write the compiler to emit Python directly; but
  emitting code as text always gets so chaotic.  This should be
  better.
</p>

</body>
</html>
