(import random)
(class Wumpus ()
       (define (rand-room self &rest avoid-rooms)
         (define (rnd) ((. self random randint) 1 20))
         (let ((res (rnd)))
           (while (in res avoid-rooms)
                  (:= res (rnd)))
           res))
       (define (__init__ self)
            (:= (. self random) ((. random Random)))
            (:= (. self links) '(()
                                 (2 5 6)
                                 (1 3 8)
                                 (2 4 10)
                                 (3 5 12)
                                 (1 4 14)
                                 (1 7 15)
                                 (6 8 17)
                                 (2 7 9)
                                 (8 10 18)
                                 (3 9 11)
                                 (10 12 19)
                                 (4 11 13)
                                 (12 14 20)
                                 (5 13 15)
                                 (6 14 16)
                                 (15 17 20)
                                 (7 16 18)
                                 (9 17 19)
                                 (11 18 20)
                                 (13 16 19)))
            (let* ((wumpus ((. self rand-room)))
                   (bat-1 ((. self rand-room) wumpus))
                   (bat-2 ((. self rand-room) wumpus bat-1)))
              (:= (. self wumpus) wumpus)
              (:= (. self bats) (mk-list bat-1 bat-2))
              (:= (. self player) ((. self rand-room) wumpus bat-1 bat-2)))
            )

       (define move-to (self dest)
         (unless (in dest ([] (. self links) (. self player)))
                 (print "Can't get there from here.")
                 (return))
         (:= (. self player) dest)
         )
       )

(let ((w (Wumpus)))
  (print (. w wumpus) (. w bats) (. w player))
  )
